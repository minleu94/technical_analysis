# Phase 2：策略資料庫設計文檔

## 目標

建立「策略資料庫」，讓策略成為「可被描述、被比較、被淘汰的東西」。

**重點不是結果，而是：**
- 哪個策略在哪種 Regime 會死
- 哪個策略其實很少有機會
- 策略的「存活率」和「適用率」

👉 **你會第一次發現：「不是策略爛，是我在錯的時候用它。」**

---

## 預設策略庫設計

### 策略 1：暴衝策略（Momentum Strategy）

#### 策略說明
**不是技術指標的組合，而是「為什麼這樣做」：**

「在趨勢明確、動能強勁的市場中，尋找價格快速上漲且成交量明顯放大的股票。這種策略假設強勢會延續，適合願意承擔高風險以換取高報酬的交易者。」

#### 適合的市場狀態
- **Regime**：Trend（趨勢追蹤）
- **市場特徵**：
  - 大盤在 MA60 之上
  - ADX > 25（趨勢強度）
  - 成交量放大

#### 不適合的市場狀態
- **Regime**：Reversion（均值回歸）
- **市場特徵**：
  - 大盤在 MA20～MA60 間震盪
  - ADX < 20（盤整）
  - 成交量萎縮

#### 策略參數（預設值）
```python
{
    'technical': {
        'momentum': {
            'rsi': {'enabled': True, 'period': 14},
            'macd': {'enabled': True, 'fast': 12, 'slow': 26, 'signal': 9}
        },
        'trend': {
            'adx': {'enabled': True, 'period': 14},
            'ma': {'enabled': True, 'windows': [5, 10, 20, 60]}
        }
    },
    'patterns': {
        'selected': ['旗形', '三角形', '矩形', 'V形反轉']
    },
    'signals': {
        'volume_conditions': ['increasing', 'spike'],
        'weights': {'pattern': 0.25, 'technical': 0.55, 'volume': 0.20}
    },
    'filters': {
        'price_change_min': 2.0,  # 最小漲幅 2%
        'volume_ratio_min': 1.5   # 成交量至少是 20 日均量的 1.5 倍
    }
}
```

#### 風險特點
- **高風險**：快速進出，可能遇到假突破
- **高報酬**：趨勢延續時報酬可觀
- **心理壓力**：需要快速決策，不適合猶豫不決的交易者

---

### 策略 2：成長型策略（Growth Strategy）

#### 策略說明
「尋找基本面良好、技術面轉強的股票。這種策略假設優質股票在技術面轉強時會有持續的上漲動能，適合願意中期持有的投資者。」

#### 適合的市場狀態
- **Regime**：Trend、Breakout
- **市場特徵**：
  - 大盤在 MA60 之上或接近突破
  - 成交量溫和放大
  - 市場情緒穩定

#### 不適合的市場狀態
- **Regime**：Reversion
- **市場特徵**：
  - 大盤在盤整區間
  - 成交量萎縮
  - 市場情緒不穩定

#### 策略參數（預設值）
```python
{
    'technical': {
        'momentum': {
            'rsi': {'enabled': True, 'period': 14},
            'macd': {'enabled': True, 'fast': 12, 'slow': 26, 'signal': 9}
        },
        'trend': {
            'ma': {'enabled': True, 'windows': [5, 10, 20, 60]}
        }
    },
    'patterns': {
        'selected': ['W底', '頭肩底', '雙底', '矩形']
    },
    'signals': {
        'volume_conditions': ['increasing'],
        'weights': {'pattern': 0.30, 'technical': 0.50, 'volume': 0.20}
    },
    'filters': {
        'price_change_min': 0.5,  # 最小漲幅 0.5%
        'rsi_min': 40,             # RSI 不低於 40（避免超賣）
        'rsi_max': 70              # RSI 不高於 70（避免超買）
    }
}
```

#### 風險特點
- **中風險**：中期持有，需要耐心
- **中報酬**：穩健成長，不會暴漲暴跌
- **心理壓力**：需要耐心等待，不適合急於求成的交易者

---

### 策略 3：穩健策略（Conservative Strategy）

#### 策略說明
「在盤整市場中尋找超賣反彈的機會。這種策略假設價格偏離均值後會回歸，適合風險承受度較低、追求穩定收益的投資者。」

#### 適合的市場狀態
- **Regime**：Reversion（均值回歸）
- **市場特徵**：
  - 大盤在 MA20～MA60 間震盪
  - ADX < 20（盤整）
  - 成交量萎縮

#### 不適合的市場狀態
- **Regime**：Trend（強勢市場）
- **市場特徵**：
  - 大盤在 MA60 之上
  - ADX > 25（趨勢強度）
  - 成交量放大

#### 策略參數（預設值）
```python
{
    'technical': {
        'momentum': {
            'rsi': {'enabled': True, 'period': 14},
            'kd': {'enabled': True}
        },
        'volatility': {
            'bollinger': {'enabled': True, 'window': 20, 'std': 2}
        }
    },
    'patterns': {
        'selected': ['W底', '雙底', '圓底']
    },
    'signals': {
        'volume_conditions': ['decreasing'],
        'weights': {'pattern': 0.30, 'technical': 0.50, 'volume': 0.20}
    },
    'filters': {
        'rsi_max': 40,              # RSI 不高於 40（超賣）
        'price_change_max': 5.0    # 最大漲幅 5%（避免追高）
    }
}
```

#### 風險特點
- **低風險**：在超賣區買入，風險相對較低
- **低報酬**：反彈幅度有限，不會有暴漲
- **心理壓力**：需要等待超賣機會，可能錯過強勢市場

---

## 策略說明文檔格式

每個策略都應該有：

1. **策略說明**（不是指標）
   - 策略的「為什麼」
   - 策略的假設
   - 策略的適用對象

2. **適合/不適合的市場狀態**
   - 明確的 Regime
   - 市場特徵描述

3. **策略參數**
   - 預設值
   - 參數說明

4. **風險特點**
   - 風險等級
   - 報酬預期
   - 心理壓力

5. **歷史表現**（待回測後補充）
   - 在不同 Regime 下的表現
   - 策略的「存活率」
   - 策略的「適用率」

---

## 單一策略回測設計

### 回測目標
不是追求最大報酬，而是：
- 策略在不同 Regime 下的表現
- 策略的「存活率」（策略條件成立的頻率）
- 策略的「適用率」（策略適合的市場狀態出現頻率）

### 回測指標
1. **基本指標**
   - 總報酬率
   - 年化報酬率
   - 最大回撤
   - 勝率

2. **Regime 分析**
   - 在 Trend 下的表現
   - 在 Reversion 下的表現
   - 在 Breakout 下的表現

3. **策略特徵**
   - 策略條件成立的頻率
   - 策略適合的市場狀態出現頻率
   - 策略的平均持有期

---

## 實作計劃

### 階段 1：策略定義（1-2 週）
- [ ] 定義 3-5 個預設策略
- [ ] 撰寫策略說明文檔
- [ ] 設定策略參數預設值

### 階段 2：策略整合（2-3 週）
- [ ] 在 UI 中增加「預設策略」選項
- [ ] 策略選擇後自動載入參數
- [ ] 策略說明顯示

### 階段 3：單一策略回測（3-4 週）
- [ ] 單一策略回測功能
- [ ] 回測結果分析
- [ ] Regime 分析

### 階段 4：策略比較（4-6 週）
- [ ] 策略比較功能
- [ ] 策略淘汰機制
- [ ] 策略表現統計

---

## 注意事項

### ✅ 現在該做
- 預設策略庫設計
- 策略說明文檔
- 單一策略回測

### ❌ 現在不要急
- 多策略組合（Phase 3）
- ML 優化（Phase 3）
- 持倉管理（Phase 4）

