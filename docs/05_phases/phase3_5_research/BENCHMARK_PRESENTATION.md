# 回測 Benchmark 對標呈現方式

## 概述

本文檔定義了**回測 Benchmark 對標的呈現方式**，目標是「不易誤導使用者」，確保使用者能正確理解策略表現相對於基準的優劣。

**核心原則**：
- Benchmark normalize 到同一尺度，便於視覺比較
- 保留 hover 顯示原始 benchmark 數值
- 明確說明對標的解讀方式

---

## 問題定義

### 為什麼需要 Benchmark 對標？

1. **評估策略價值**：如果策略不如簡單的 Buy & Hold，說明策略沒有價值
2. **風險調整比較**：比較策略與基準的風險調整後表現
3. **穩健性驗證**：驗證策略在不同市場環境下是否優於基準

### 常見誤導情況

1. **尺度不一致**：策略和基準使用不同的起始點或尺度，導致視覺比較困難
2. **缺少原始數值**：只顯示相對表現，無法了解絕對表現
3. **解讀不明確**：使用者不知道如何正確解讀對標結果

---

## 呈現方案

### 方案 1：權益曲線對比（Equity Curve Comparison）

#### 視覺呈現

**圖表設計**：
- X 軸：時間（日期）
- Y 軸：累積報酬率（%），從 0% 開始
- 兩條線：
  - **策略線**：藍色實線
  - **Baseline 線**：灰色虛線

**Normalize 方式**：
- 兩條線都從**同一起始點**（0%）開始
- 計算每個時間點的累積報酬率：
  ```
  策略累積報酬率 = (策略權益 / 初始資金 - 1) × 100%
  Baseline 累積報酬率 = (Baseline 權益 / 初始資金 - 1) × 100%
  ```

**Hover 顯示**：
- 滑鼠懸停在圖表上時，顯示：
  ```
  日期：2024-01-15
  策略累積報酬率：+15.2%
  Baseline 累積報酬率：+8.5%
  超額報酬率：+6.7%
  ```

**圖例說明**：
```
┌─────────────────────────────────────┐
│ 圖例                                │
├─────────────────────────────────────┤
│ ─── 策略表現（藍色實線）              │
│ ─ ─ Baseline（灰色虛線）              │
│                                     │
│ 說明：兩條線都從 0% 開始，便於比較    │
│ 超額報酬率 = 策略報酬率 - Baseline    │
└─────────────────────────────────────┘
```

---

### 方案 2：指標對比表格（Metrics Comparison Table）

#### 表格設計

**表格結構**：
```
┌─────────────────┬──────────┬──────────┬────────────┐
│ 指標            │ 策略     │ Baseline │ 差異       │
├─────────────────┼──────────┼──────────┼────────────┤
│ 總報酬率        │ +15.2%   │ +8.5%    │ +6.7% ✅   │
│ 年化報酬率      │ +12.5%   │ +7.2%    │ +5.3% ✅   │
│ 夏普比率        │ 0.85     │ 0.52     │ +0.33 ✅   │
│ 最大回撤        │ -12.3%   │ -15.8%   │ +3.5% ✅   │
│ 勝率            │ 58%      │ N/A      │ N/A        │
│ 總交易次數      │ 45       │ 1        │ +44        │
└─────────────────┴──────────┴──────────┴────────────┘
```

**顏色標記**：
- ✅ **綠色**：策略優於 Baseline
- ❌ **紅色**：策略劣於 Baseline
- ⚪ **灰色**：無法比較（例如：Baseline 沒有勝率）

**Hover 顯示**：
- 滑鼠懸停在「差異」欄位時，顯示：
  ```
  超額報酬率：+6.7%
  相對改善：+78.8%（相對於 Baseline）
  ```

---

### 方案 3：超額報酬率圖表（Excess Return Chart）

#### 視覺呈現

**圖表設計**：
- X 軸：時間（日期）
- Y 軸：超額報酬率（%），從 0% 開始
- 一條線：策略相對於 Baseline 的超額報酬率

**計算方式**：
```
超額報酬率(t) = 策略累積報酬率(t) - Baseline 累積報酬率(t)
```

**顏色標記**：
- **正數區域**（策略優於 Baseline）：綠色填充
- **負數區域**（策略劣於 Baseline）：紅色填充
- **零線**：灰色虛線

**Hover 顯示**：
- 滑鼠懸停在圖表上時，顯示：
  ```
  日期：2024-01-15
  策略累積報酬率：+15.2%
  Baseline 累積報酬率：+8.5%
  超額報酬率：+6.7%
  相對改善：+78.8%
  ```

---

## 推薦呈現組合

### 主要呈現方式

**建議使用「方案 1：權益曲線對比」作為主要呈現方式**，因為：
1. 視覺直觀，容易理解
2. 可以同時看到策略和基準的表現
3. 可以識別策略在不同時期的相對表現

### 輔助呈現方式

**建議使用「方案 2：指標對比表格」作為輔助呈現方式**，因為：
1. 提供具體數值，便於精確比較
2. 涵蓋多個指標，全面評估
3. 顏色標記清晰，快速識別優劣

### 可選呈現方式

**「方案 3：超額報酬率圖表」可作為可選呈現方式**，用於：
1. 深入分析策略相對於基準的表現變化
2. 識別策略在哪些時期優於/劣於基準

---

## 解讀說明

### 如何解讀權益曲線對比？

**正確解讀**：
1. **兩條線都從 0% 開始**：這是 normalize 後的結果，便於比較
2. **策略線在 Baseline 線上方**：表示策略優於基準
3. **策略線在 Baseline 線下方**：表示策略劣於基準
4. **兩條線的差距**：表示超額報酬率

**常見誤解**：
- ❌ 「策略線在 Baseline 線上方，所以策略報酬率是 Baseline 的 X 倍」
  - 正確：策略線在 Baseline 線上方，表示策略的**累積報酬率**高於基準，但不一定是倍數關係
- ❌ 「兩條線都從 0% 開始，所以初始資金相同」
  - 正確：兩條線都從 0% 開始是為了 normalize，實際初始資金可能不同（但通常相同）

---

### 如何解讀指標對比表格？

**正確解讀**：
1. **總報酬率差異**：策略總報酬率 - Baseline 總報酬率 = 超額報酬率
2. **夏普比率差異**：策略夏普比率 - Baseline 夏普比率 = 風險調整後的相對表現
3. **最大回撤差異**：策略最大回撤 - Baseline 最大回撤（負數表示策略回撤更小）

**常見誤解**：
- ❌ 「超額報酬率 +6.7%，所以策略報酬率是 Baseline 的 1.787 倍」
  - 正確：超額報酬率是**絕對差異**，不是倍數關係。如果 Baseline 是 +8.5%，策略是 +15.2%，則策略報酬率是 Baseline 的 1.788 倍（15.2% / 8.5%），但超額報酬率是 +6.7%（15.2% - 8.5%）
- ❌ 「最大回撤差異 +3.5%，所以策略回撤更大」
  - 正確：最大回撤是**負數**（例如：-12.3%），差異 +3.5% 表示策略回撤**更小**（-12.3% - (-15.8%) = +3.5%）

---

## UI 實作建議

### 權益曲線對比圖表

**技術實作**：
- 使用 `matplotlib` 或 `PyQtGraph` 繪製
- 兩條線使用不同顏色和樣式（實線 vs 虛線）
- 添加 hover 功能，顯示具體數值

**代碼範例**（偽代碼）：
```python
# 計算累積報酬率
strategy_cumulative = (strategy_equity / initial_capital - 1) * 100
baseline_cumulative = (baseline_equity / initial_capital - 1) * 100

# 繪製圖表
plt.plot(dates, strategy_cumulative, label='策略表現', color='blue', linewidth=2)
plt.plot(dates, baseline_cumulative, label='Baseline', color='gray', linestyle='--', linewidth=2)
plt.axhline(y=0, color='black', linestyle='-', linewidth=0.5)
plt.ylabel('累積報酬率 (%)')
plt.legend()
plt.title('策略 vs Baseline 權益曲線對比')
```

---

### 指標對比表格

**技術實作**：
- 使用 `QTableWidget` 或 `PandasTableModel` 顯示
- 根據差異正負值設置單元格顏色
- 添加 tooltip，顯示詳細說明

**代碼範例**（偽代碼）：
```python
# 創建對比表格
comparison_data = {
    '指標': ['總報酬率', '年化報酬率', '夏普比率', '最大回撤'],
    '策略': [strategy_total_return, strategy_annual_return, strategy_sharpe, strategy_max_dd],
    'Baseline': [baseline_total_return, baseline_annual_return, baseline_sharpe, baseline_max_dd],
    '差異': [excess_return, excess_annual, excess_sharpe, excess_dd]
}

# 設置顏色
for row in range(len(comparison_data)):
    diff = comparison_data['差異'][row]
    if diff > 0:
        # 綠色：策略優於 Baseline
        set_cell_color(row, 3, 'green')
    elif diff < 0:
        # 紅色：策略劣於 Baseline
        set_cell_color(row, 3, 'red')
```

---

## 總結

**推薦呈現方案**：
1. **主要**：權益曲線對比（方案 1）
2. **輔助**：指標對比表格（方案 2）
3. **可選**：超額報酬率圖表（方案 3）

**關鍵原則**：
- ✅ Benchmark normalize 到同一尺度（從 0% 開始）
- ✅ 保留 hover 顯示原始 benchmark 數值
- ✅ 明確說明對標的解讀方式（在 UI 中添加說明文字）

**避免誤導**：
- ❌ 不要使用不同的起始點或尺度
- ❌ 不要只顯示相對表現，隱藏絕對數值
- ❌ 不要使用容易誤解的圖表設計

---

**文檔版本**：v1.0  
**最後更新**：2026-01-02  
**適用階段**：Phase 3.5 (Readiness)

