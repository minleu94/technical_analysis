# 指標判讀優先順序

## 概述

本文檔定義了回測指標的**優先順序**和**判讀標準**，幫助使用者在固定時間內快速判斷回測結果的合理性。

**核心原則**：
- **Primary 指標**：決策用，必須優先查看
- **Secondary 指標**：輔助解釋，用於深入理解
- **樣本不足提示**：當數據不足以判斷時，明確提示使用者

---

## 指標分類

### Primary 指標（決策用）

這些指標是**判斷策略是否可用的核心依據**，必須優先查看。

#### 1. 行為健康指標（Behavior Health）

**優先級**：最高

**包含指標**：
- **交易次數（Total Trades）**
  - 合理範圍：10-100 次
  - < 5 次：信號不足，無法判斷策略有效性
  - > 200 次：可能過度交易，需要檢查
- **平均持有天數（Average Holding Days）**
  - 短線策略：3-10 天
  - 中線策略：10-30 天
  - 長線策略：30+ 天
  - 不符合策略類型：需要調整 Execution 參數

**判讀標準**：
- ✅ **可分析**：交易次數 10-100 次，平均持有天數符合策略類型
- ❌ **退回調整**：交易次數 < 5 次或 > 200 次，平均持有天數不符合策略類型

**為什麼優先級最高？**
- 如果行為不合理（交易太少或太多、持有時間不符合預期），後續的報酬率、Sharpe 等指標都不可信
- 必須先確保策略行為符合預期，才能判斷策略是否有效

---

#### 2. 穩健性指標（Robustness）

**優先級**：高

**包含指標**：
- **Walk-Forward 一致性（Consistency）**
  - 標準：>= 60% 為佳
  - < 50%：策略在不同時期表現差異大，不穩定
- **平均退化程度（Average Degradation）**
  - 標準：< 40% 為佳
  - >= 50%：策略可能過擬合
- **過擬合風險等級（Overfitting Risk Level）**
  - 標準：低風險為佳
  - 高風險：必須退回調整，不能進入 Phase 4

**判讀標準**：
- ✅ **可分析**：一致性 >= 60%，退化程度 < 40%，過擬合風險「低」或「中」
- ❌ **退回調整**：一致性 < 50%，退化程度 >= 50%，過擬合風險「高」

**為什麼優先級高？**
- 穩健性決定了策略在未來市場環境中是否仍能保持穩定表現
- 如果穩健性差，即使歷史報酬率高，也不適合實際使用

---

#### 3. Baseline 對比（Baseline Comparison）

**優先級**：高

**包含指標**：
- **是否優於 Buy & Hold**
  - 標準：策略總報酬率或 Sharpe Ratio 優於 Buy & Hold
  - 如果不如 Buy & Hold：需要重新評估策略價值
- **超額報酬率（Excess Return）**
  - 標準：> 0% 為佳
  - < 0%：策略不如被動持有

**判讀標準**：
- ✅ **可分析**：策略表現優於 Buy & Hold（至少總報酬率或 Sharpe Ratio 優於基準）
- ❌ **退回調整**：策略表現不如 Buy & Hold

**為什麼優先級高？**
- 如果策略不如簡單的 Buy & Hold，說明策略沒有價值
- 必須先確保策略優於基準，才能考慮其他指標

---

### Secondary 指標（輔助解釋）

這些指標用於**深入理解策略表現**，但不作為主要決策依據。

#### 1. 報酬率指標（Return Metrics）

**包含指標**：
- 總報酬率（Total Return）
- 年化報酬率（Annual Return）
- 期望值（Expectancy）

**使用場景**：
- 在行為健康和穩健性都通過後，用於評估策略的獲利能力
- 用於比較不同參數組合的表現

**判讀標準**：
- 沒有絕對標準，需要結合其他指標綜合判斷
- 如果報酬率過高（> 100%），需要特別注意是否過擬合

---

#### 2. 風險調整指標（Risk-Adjusted Metrics）

**包含指標**：
- 夏普比率（Sharpe Ratio）
- 最大回撤（Max Drawdown）
- 獲利因子（Profit Factor）

**使用場景**：
- 在報酬率指標通過後，用於評估策略的風險調整後表現
- 用於比較不同策略的風險效率

**判讀標準**：
- Sharpe Ratio：> 0.5 為佳，> 1.0 為優秀
- Max Drawdown：< 30% 為佳（可根據策略類型調整）
- Profit Factor：> 1.5 為佳

---

#### 3. 交易品質指標（Trade Quality Metrics）

**包含指標**：
- 勝率（Win Rate）
- 平均獲利（Avg Win）
- 平均虧損（Avg Loss）
- 最大連續虧損次數（Max Consecutive Losses）

**使用場景**：
- 用於理解策略的交易特徵
- 用於識別策略的潛在問題（例如：勝率低但獲利大、勝率高但虧損大）

**判讀標準**：
- 勝率：> 50% 為佳，但需要結合平均獲利/虧損判斷
- 最大連續虧損：< 5 次為佳

---

## 樣本不足提示標準

當數據不足以判斷策略有效性時，系統應該明確提示使用者。

### 提示條件

#### 1. 交易次數不足

**條件**：總交易次數 < 10 次

**提示訊息**：
```
⚠️ 樣本不足：交易次數僅 {total_trades} 次，無法可靠判斷策略有效性。
建議：
- 擴大回測期間範圍
- 降低 buy_score 或 sell_score 閾值
- 檢查選股清單是否合適
```

#### 2. 回測期間過短

**條件**：回測期間 < 3 個月

**提示訊息**：
```
⚠️ 樣本不足：回測期間僅 {days} 天，無法充分驗證策略穩健性。
建議：
- 至少回測 6 個月以上的數據
- 如果數據不足，考慮使用更長的歷史數據
```

#### 3. Walk-Forward Fold 數量不足

**條件**：Walk-Forward Fold 數量 < 3 個

**提示訊息**：
```
⚠️ 樣本不足：Walk-Forward 僅有 {fold_count} 個 Fold，無法可靠評估策略穩健性。
建議：
- 擴大回測期間範圍
- 調整訓練期/測試期長度，確保至少 3 個 Fold
```

#### 4. 單一股票回測

**條件**：僅回測單一股票

**提示訊息**：
```
ℹ️ 單一股票回測：本次回測僅包含 {stock_code}，結果可能不具代表性。
建議：
- 使用選股清單進行批次回測，驗證策略泛化能力
- 或至少回測 3-5 檔不同類型的股票
```

---

## 指標判讀流程圖

```
開始
  ↓
[步驟 1] 檢查行為健康指標
  ├─ 交易次數：10-100 次？
  ├─ 平均持有天數：符合策略類型？
  └─ ❌ 不符合 → 退回調整
  ↓ ✅ 符合
[步驟 2] 檢查穩健性指標
  ├─ Walk-Forward 一致性 >= 60%？
  ├─ 退化程度 < 40%？
  ├─ 過擬合風險等級：低/中？
  └─ ❌ 不符合 → 退回調整
  ↓ ✅ 符合
[步驟 3] 檢查 Baseline 對比
  ├─ 策略表現優於 Buy & Hold？
  └─ ❌ 不符合 → 退回調整
  ↓ ✅ 符合
[步驟 4] 查看 Secondary 指標（輔助判斷）
  ├─ 報酬率指標
  ├─ 風險調整指標
  └─ 交易品質指標
  ↓
[結論] 策略是否可用？
  ├─ ✅ 可用 → 可以 Promote 或進入 Phase 4
  └─ ❌ 不可用 → 退回調整
```

---

## UI 顯示建議

### Primary 指標顯示位置

**建議**：在回測結果面板的**最上方**，使用**醒目的視覺設計**（例如：大號字體、顏色標記）

**顯示內容**：
```
┌─────────────────────────────────────┐
│ 行為健康指標（必須優先查看）          │
├─────────────────────────────────────┤
│ 交易次數：45 次 ✅                    │
│ 平均持有天數：8 天 ✅（短線策略）     │
│                                     │
│ 穩健性指標                           │
│ Walk-Forward 一致性：65% ✅          │
│ 平均退化程度：25% ✅                  │
│ 過擬合風險等級：低 ✅                │
│                                     │
│ Baseline 對比                        │
│ 策略總報酬率：15.2%                  │
│ Buy & Hold 總報酬率：8.5%            │
│ 超額報酬率：+6.7% ✅                  │
└─────────────────────────────────────┘
```

### Secondary 指標顯示位置

**建議**：在 Primary 指標**下方**，使用**折疊區塊**或**次要視覺設計**

**顯示內容**：
```
┌─────────────────────────────────────┐
│ 詳細績效指標（展開查看）              │
├─────────────────────────────────────┤
│ 總報酬率：15.2%                      │
│ 年化報酬率：12.5%                    │
│ 夏普比率：0.85                       │
│ 最大回撤：-12.3%                     │
│ 勝率：58%                            │
│ 獲利因子：1.8                        │
└─────────────────────────────────────┘
```

### 樣本不足提示顯示位置

**建議**：在回測結果面板的**頂部**，使用**警告圖示**和**黃色背景**

**顯示內容**：
```
⚠️ 樣本不足提示
交易次數僅 3 次，無法可靠判斷策略有效性。
建議：擴大回測期間範圍或降低 buy_score 閾值。
```

---

## 總結

**判讀優先順序**：
1. **行為健康**（交易數、持有天數）> 
2. **穩健性**（Walk-Forward、過擬合風險）> 
3. **Baseline 對比**（是否優於 Buy & Hold）> 
4. **報酬率**（總報酬、年化報酬）> 
5. **Sharpe/PF**（風險調整指標）

**關鍵原則**：
- 先確保行為合理，再判斷策略有效性
- 先確保穩健性，再評估報酬率
- 先確保優於基準，再優化參數

---

**文檔版本**：v1.0  
**最後更新**：2026-01-02  
**適用階段**：Phase 3.5 (Readiness)

